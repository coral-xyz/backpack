<!-- This file is only used by the mobile app -->
<html>
  <head>
    <title>service worker loader</title>
  </head>
  <body>
    <script type="module">
      (async function setup() {
        try {
          console.log(new URL("./service-worker.ts", import.meta.url));
          const registration = await navigator.serviceWorker.register(
            new URL("./service-worker.ts", import.meta.url),
            {
              type: "module",
            }
          );

          navigator.serviceWorker.onmessage = (event) => {
            alert(JSON.stringify(event));
          };

          window.forward = (msg) => {
            alert(JSON.stringify(msg));
            console.log({ forwarding: msg });
            navigator.serviceWorker.controller.postMessage(msg);
          };

          document.write("background script service worker registered");
        } catch (err) {
          document.write(JSON.stringify({ err }));
        }
      })();
    </script>
  </body>
</html>
